{"version":3,"file":"index.js","sources":["../src/proxyMiddleware.js","../src/utils.js","../src/model.js","../src/component/createHoc.js","../src/component/modelHoc.js","../src/effect.js","../src/reducer.js","../src/index.js"],"sourcesContent":["\n/**\n *  redux Middleware\n * @param apply proxy hander apply\n */\nexport default function proxyMiddleware(apply){\n    return () => (next) => (action) =>{\n        const hander = { apply }\n        const dispatch = new Proxy(next,hander)\n        return dispatch(action)\n    }\n}","/**\n * 数据类型校验\n * @param type 待校验类型\n */\nexport function isType (type){\n    return  Object.prototype.toString.call(type).slice(8,-1)\n  }\n\n/* 字符串类型 */\nexport function isString (type) {\n    return isType(type) === 'String'\n}\n\n/* 数字类型 */\nexport function isNumber (type){\n    return isType(type) === 'Number'\n}\n\n/* 函数类型 */\nexport function isFuntion (type){\n    return isType(type) === 'Function'\n}\n\n/* 数组类型 */\nexport function isArray (type){\n    return isType(type) === 'Array'\n}\n\n/* 对象类型 */\nexport function isObject (type){\n    return isType(type) === 'Object'\n}\n\n/* Returns an empty object */\nexport const noop = () => ({});\n\n/* warn function */\nexport function warn(is,warnText){\n    if(!is){\n        console.warn( warnText )\n    }\n}\n\n/* Check whether it is a promise object */\nexport function isPromise(promise) {\n    return !!promise && ( isObject(promise)|| isFuntion(promise) ) &&  isFuntion(promise.then)\n}\n","import * as path from 'path'\nimport invariant from 'invariant'\n\nimport {\n    isObject,\n    isType,\n    noop,\n    isFuntion\n} from './utils'\n\nconst filesMap = new Map()\n\nlet isAutoCollectModels = true\n\nconst f1 = (key) => path.basename(key).split('.')[0] === 'model'\n\nconst f2 = (file) => (key) => file(key).default\n\nconst f3 = (fileObject) => isObject(fileObject) && (fileObject.nameSpace || fileObject.state || fileObject.reducer || fileObject.effect)\n\nconst f4 = (fileObject) => (fileObject.nameSpace || fileObject.baseNameSpace) && filesMap.set(fileObject.nameSpace || fileObject.baseNameSpace, fileObject)\n\nconst f5 = (fns) => {\n    for (let fn in fns) {\n        !isFuntion(fns[fn]) && delete fns[fn]\n    }\n}\n\n/**\n * One method is used to deeply collect the files under the model file\n */\nfunction pageCollector() {\n    try {\n        const pageFile = require.context('../../../src/page', true, /\\.tsx?|jsx?$/)\n        pageFile.keys()\n            .filter(f1)\n            .map(f2(pageFile))\n            .filter(f3)\n            .forEach(f4)\n    } catch (e) {\n        console.warn(e)\n    }\n}\n\n/**\n * One method is used to deeply collect the files under the page file\n */\nfunction modelCollector() {\n    try {\n        const modelFile = require.context('../../../src/model', true, /\\.tsx?|jsx?$/)\n        modelFile.keys()\n            .map((key) => {\n                const file = f2(modelFile)(key)\n                isObject(file) && (file.baseNameSpace = path.basename(key).split('.')[0])\n                return file\n            })\n            .filter(f3)\n            .forEach(f4)\n    } catch (e) {\n        console.warn(e)\n    }\n}\n\n/**\n *\n * @param models a standard model\n */\nfunction checkModel(models) {\n    if (models) {\n        /**\n         * If there is no automatic collection of models, you can immediately collect models manually here\n         */\n        invariant(\n            isObject(models),\n            `Models are required to be an object property , but got ${ isType(models) }`\n        )\n        for (let model in models) {\n            const m = models[model]\n            !m.nameSpace && (m.nameSpace = model)\n            f3(m) && f4(m)\n        }\n    }\n    /* check every models */\n    filesMap.forEach((value) => {\n        const {\n            reducer,\n            state,\n            effect\n        } = value\n            !isObject(state) && (value.state = noop());\n        (!isObject(reducer)) && (value.reducer = noop());\n        (!isObject(effect)) && (value.effect = noop());\n        f5(reducer)\n        f5(effect)\n    })\n}\n\n/**\n * Do you want to collect models under the page folder\n * @param isPage\n */\nfunction autoInjectModel(isPage) {\n    if (!isAutoCollectModels) return\n    if (isPage) {\n        pageCollector()\n    }\n    modelCollector()\n    checkModel()\n}\n\n/* get a rux model */\nconst getModel = (nameSpace) => filesMap.get(nameSpace)\n\n/* map model to store */\nfunction mapModels(nameSpace, store, map = noop()) {\n    if (Array.isArray(nameSpace)) {\n         nameSpace.forEach(n=>{\n             mapModels(n,store,map)\n         })\n    } else {\n        const currentModel = getModel(nameSpace)\n        if (currentModel) {\n            const {\n                state\n            } = currentModel\n            for (let name in state) {\n                map[name] = store[nameSpace][name]\n            }\n        }\n    }\n    return map\n}\n\n\n\n\nconst autoCollectModels = () => isAutoCollectModels = false\n\nexport {\n    autoInjectModel,\n    autoCollectModels,\n    checkModel,\n    getModel,\n    filesMap,\n    mapModels\n}","import { createElement } from 'react'\nimport { Provider } from 'react-redux'\n\n/**\n *\n * @param {*} app rux app\n * @param {*} render render function\n */\nexport default function createHoc(app, render) {\n    return function index() {\n        return createElement(Provider, {\n            store: app._store\n        }, render())\n    }\n}","import { connect  } from 'react-redux'\n\nimport { mapModels } from '../model'\n\n/**\n * Inject the entire model directly into the component\n * @param nameSpace model nameSpace\n */\nfunction model(nameSpace){\n    return (Content) => connect((store) => mapModels(nameSpace,store))(Content)\n}\n\nexport default model","\n\n/**\n * find current effect functions\n * @param effects\n * @param name\n */\nexport function isEffect(effects,name){\n    let  effect = null\n    for(let  e in effects ){\n        e === name && (effect = effects[e] )\n    }\n    return effect\n}\n\n/**\n *\n * @param target\n * @param contextThis\n * @param nameSpace\n */\nexport default function handerEffect(target,contextThis,nameSpace){\n    return function (action){\n          const { type } = action\n          const newAction = {\n              ...action,\n              type: ~type.indexOf('.') ? type  : `${nameSpace}.${type}`\n          }\n          return Reflect.apply(target,contextThis,[ newAction ])\n    }\n}","\n/**\n * @param actionType\n * @param reducer\n */\nfunction handleAction(actionType,reducer,nameSpace) {\n    return (state, action) => {\n      const { type } = action\n      const typeArr = type.split('.')\n      if (actionType === typeArr[1] && nameSpace === typeArr[0] ) {\n        return reducer(state, action)\n      }\n      return state\n    }\n}\n\n/**\n * @param reducers reducers\n * reference: https://github.com/dvajs/dva/blob/master/packages/dva-core/src/handleActions.js\n */\nfunction reduceReducers(...reducers) {\n    return (previous, current) => reducers.reduce((p, r) => r(p, current), previous);\n}\n\n/**\n * @param handlers  reducer handers\n * @param defaultState  state\n */\nfunction handleActions(handlers, defaultState,nameSpace) {\n    const reducers = Object.keys(handlers).map(type => handleAction(type, handlers[type],nameSpace));\n    const reducer = reduceReducers(...reducers);\n    return (state = defaultState, action) => reducer(state, action);\n}\n\n/**\n *\n * @param models\n */\nfunction createReduder(models){\n    const reducers = {}\n    models.forEach((model,key)=>{\n        const { state, reducer } = model\n        reducers[key] = handleActions(reducer,state,key)\n    })\n   return reducers\n}\n\n\nexport { handleActions as handerReduer }\n\nexport { createReduder }","import invariant from 'invariant'\nimport {\n  combineReducers,\n  applyMiddleware,\n  createStore\n} from 'redux'\n\nimport {\n  connect\n} from 'react-redux'\nimport proxyMiddleware from './proxyMiddleware'\nimport {\n  autoInjectModel,\n  checkModel,\n  filesMap,\n  autoCollectModels\n} from './model'\nimport createHOC from './component/createHoc'\nimport modelHOC from './component/modelHoc'\nimport {\n  isObject,\n  isString,\n  isFuntion,\n  warn\n} from './utils'\nimport handerEffect, { isEffect } from './effect'\nimport {\n  createReduder\n} from './reducer'\n\n\n\nfunction createAppApi() {\n\n  /* A unique identifier for each event subscriber  */\n  let eventId = 0\n\n  const app = {\n    _model: filesMap,\n    initialState: {},\n    subscribe: []\n  }\n\n  /**\n   * dispatch a eventType\n   * @param eventType\n   */\n  function dispatchEvent(eventType) {\n    console.log(eventType)\n  }\n\n  /**\n   * get app state\n   */\n  function getState() {\n    invariant(\n      app._store,\n      'app store does not exist.'\n    )\n    return app._store.getState()\n  }\n\n  /**\n   * subscribe events\n   * There are two cases for the subscribe function parameter\n   * First, global add subscription\n   * for example  subscribe((newState)=>{})\n   * The second，Add a listener for an effect or a reducer\n   * for example , subscribe('index.getData',(oldState,newState) => {})\n   * @param fn subscribe callback\n   */\n  function subscribe(...arg) {\n    const a1 = arg[0]\n    const a2 = arg[1]\n    const queue = app.subscribe\n    const unSubscribe = (f) => {\n      return function () {\n        const index = queue.findIndex((fn) => f(fn))\n        queue.splice(index, 1)\n      }\n    }\n    if (arg.length === 2 && isString(a1) && isFuntion(a2)) {\n      const fn = a2\n      fn.$$event = a1\n      fn.$$eventId = ++ eventId\n      queue.push(fn)\n      return unSubscribe((fn) => a2.$$event === fn.$$event && a2.$$eventId ===fn.$$eventId )\n    } else if (arg.length === 1 && isFuntion(a1)) {\n      a1.$$eventId = ++ eventId\n      queue.push(a1)\n      return unSubscribe((fn) => fn === a1 && fn.$$eventId === a1.$$eventId )\n    } else {\n      warn(\n        false,\n        'Parameters do not match .'\n      )\n      return () => {}\n    }\n  }\n\n  /**\n   * Running special listeners\n   * @param type for example subscribe(type , callback)\n   */\n  function runcallbackQuene(type) {\n    const pre = getState()\n    return function () {\n      const next = getState()\n      app.subscribe.filter((fn) => fn.$$event === type).forEach(fn => fn.apply(null, [pre, next]))\n    }\n  }\n\n  /**\n   * proxy hander function\n   * @param target  redux store dispatch\n   * @param contextThis  context\n   * @param arg Parameter array\n  */\n  function apply(target, contextThis, arg) {\n    invariant(\n      isObject(arg[0]),\n      'dispatch parameter must be a objecy'\n    )\n    const { type } = arg[0]\n    invariant(\n      type && isString(type),\n      'Type is required in the first parameter of the dispatch ,and  type expected to be a string type'\n    )\n    const run = runcallbackQuene(type)\n\n    const actionTypeArr = type.split('.')\n    let result = null\n    if (actionTypeArr.length === 2) {\n\n      /* Resolution type */\n      const nameSpace = actionTypeArr[0]\n      const currentName = actionTypeArr[1]\n      const currentModel = app._model.get(nameSpace)\n\n      if (!currentModel) return dispatchEvent(nameSpace)\n\n      /* effect  */\n      const effect = isEffect(currentModel.effect, currentName)\n      if (effect) {\n        result = (effect).call(currentModel, handerEffect(target, contextThis, nameSpace), ...arg)\n        Promise.resolve().then(() => {\n          run()\n        })\n      } else {\n        result = Reflect.apply(target, contextThis, arg)\n        run()\n      }\n\n    } else {\n      result = Reflect.apply(target, contextThis, arg)\n      run()\n    }\n    return result\n  }\n\n  /**\n   * create a element\n   * @param config  model config\n   * @param element a reactElement\n   */\n  function create(config, element) {\n    invariant(\n      isObject(config),\n      'The first parameter is expected to be an object'\n    )\n    invariant(\n      isFuntion(element),\n      'The second parameter of createApp is expected to be a function'\n    )\n    const {\n      deep = false\n    } = (isObject(config) ? config : {})\n    const middleware = proxyMiddleware(apply)\n    autoInjectModel(deep)\n\n    /*  create a redux store  */\n    const store = app._store = createStore(\n      combineReducers(createReduder(app._model)),\n      app.initialState,\n      applyMiddleware(middleware)\n    )\n\n    /*  Register event listener  */\n    app.unSubscribe = store.subscribe(() => {\n      const subscribe = app.subscribe\n      subscribe.forEach((fn) => {\n        !fn.$$event && fn(store.getState())\n      })\n    })\n    return createHOC(app, element)()\n  }\n\n  /**\n   * register a middleware\n   * @param middleware rux middleware include nameSpace, reducer, effect, state\n   */\n  function use(middleware) {\n    console.log(middleware)\n  }\n\n  /**\n   * inject a rux model\n   * @param models\n   */\n  function injectModel(models) {\n    autoCollectModels()\n    checkModel(models)\n  }\n\n  /* Exposed API */\n  return {\n    create,\n    use,\n    injectModel,\n    subscribe\n  }\n}\n\nconst app = createAppApi()\nconst exportSubscribe = app.subscribe\n\nexport {  modelHOC as model }\nexport { exportSubscribe as subscribe }\nexport { connect }\nexport { autoInjectModel as injectModel }\nexport default app\n\n"],"names":["proxyMiddleware","apply","next","action","hander","dispatch","Proxy","isType","type","Object","prototype","toString","call","slice","isString","isFuntion","isObject","noop","warn","is","warnText","console","filesMap","Map","isAutoCollectModels","f1","key","path","split","f2","file","f3","fileObject","nameSpace","state","reducer","effect","f4","baseNameSpace","set","f5","fns","fn","pageCollector","pageFile","require","context","keys","filter","map","forEach","e","modelCollector","modelFile","checkModel","models","invariant","model","m","value","autoInjectModel","isPage","getModel","get","mapModels","store","Array","isArray","n","currentModel","name","autoCollectModels","createHoc","app","render","index","createElement","Provider","_store","Content","connect","isEffect","effects","handerEffect","target","contextThis","newAction","indexOf","Reflect","handleAction","actionType","typeArr","reduceReducers","reducers","previous","current","reduce","p","r","handleActions","handlers","defaultState","createReduder","createAppApi","eventId","_model","initialState","subscribe","dispatchEvent","eventType","log","getState","a1","a2","queue","unSubscribe","f","findIndex","splice","length","$$event","$$eventId","push","runcallbackQuene","pre","arg","run","actionTypeArr","result","currentName","Promise","resolve","then","create","config","element","deep","middleware","createStore","combineReducers","applyMiddleware","createHOC","use","injectModel","exportSubscribe"],"mappings":"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"}