!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("invariant"),require("redux"),require("react-redux"),require("path"),require("react")):"function"==typeof define&&define.amd?define(["exports","invariant","redux","react-redux","path","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ruxjs={},e.invariant,e.redux,e.reactRedux,e.path,e.react)}(this,function(e,t,i,u,n,a){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var b=r(t);function c(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function v(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?c(Object(o),!0).forEach(function(e){var t,r;t=n,e=o[r=e],r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):c(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})}return n}function y(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e){return Object.prototype.toString.call(e).slice(8,-1)}function m(e){return"String"===f(e)}function s(e){return"Function"===f(e)}function h(e){return"Object"===f(e)}var l=function(){return{}};var p=new Map,d=!0,g=function(e){return"model"===n.basename(e).split(".")[0]},j=function(t){return function(e){return t(e).default}},O=function(e){return h(e)&&(e.nameSpace||e.state||e.reducer||e.effect)},$=function(e){return(e.nameSpace||e.baseNameSpace)&&p.set(e.nameSpace||e.baseNameSpace,e)},x=function(e){for(var t in e)s(e[t])||delete e[t]};function S(e){if(e)for(var t in b.default(h(e),"Models are required to be an object property , but got ".concat(f(e))),e){var r=e[t];r.nameSpace||(r.nameSpace=t),O(r)&&$(r)}p.forEach(function(e){var t=e.reducer,r=e.state,n=e.effect;h(r)||(e.state=l()),h(t)||(e.reducer=l()),h(n)||(e.effect=l()),x(t),x(n)})}function w(e){d&&(e&&function(){try{var e=require.context("../../../src/page",!0,/\.tsx?|jsx?$/);e.keys().filter(g).map(j(e)).filter(O).forEach($)}catch(e){console.warn(e)}}(),function(){try{var r=require.context("../../../src/model",!0,/\.tsx?|jsx?$/);r.keys().map(function(e){var t=j(r)(e);return h(t)&&(t.baseNameSpace=n.basename(e).split(".")[0]),t}).filter(O).forEach($)}catch(e){console.warn(e)}}(),S())}var P=function(e){return p.get(e)};function A(t,e,r){var n=Object.keys(t).map(function(e){return o=t[n=e],c=r,function(e,t){var r=t.type.split(".");return n===r[1]&&c===r[0]?o(e,t):e};var n,o,c}),o=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r){return t.reduce(function(e,t){return t(e,r)},e)}}.apply(void 0,y(n));return function(){return o(0<arguments.length&&void 0!==arguments[0]?arguments[0]:e,1<arguments.length?arguments[1]:void 0)}}var E,I,q=(E=0,I={_model:p,initialState:{},subscribe:[]},{create:function(e,t){b.default(h(e),"The first parameter is expected to be an object"),b.default(s(t),"The second parameter of createApp is expected to be a function");var r,n=(h(e)?e:{}).deep,e=(r=M,function(){return function(t){return function(e){return new Proxy(t,{apply:r})(e)}}});w(void 0!==n&&n);var o,c=I._store=i.createStore(i.combineReducers((n=I._model,o={},n.forEach(function(e,t){var r=e.state,e=e.reducer;o[t]=A(e,r,t)}),o)),I.initialState,i.applyMiddleware(e));return I.unSubscribe=c.subscribe(function(){I.subscribe.forEach(function(e){e.$$event||e(c.getState())})}),e=I,t=t,a.createElement(u.Provider,{store:e._store},t())},use:function(e){console.log(e)},injectModel:function(e){d=!1,S(e)},subscribe:function(){function e(t){return function(){var e=n.findIndex(function(e){return t(e)});n.splice(e,1)}}var t=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],n=I.subscribe;if(2===arguments.length&&m(t)&&s(r)){var o=r;return o.$$event=t,o.$$eventId=++E,n.push(o),e(function(e){return r.$$event===e.$$event&&r.$$eventId===e.$$eventId})}return 1===arguments.length&&s(t)?(t.$$eventId=++E,n.push(t),e(function(e){return e===t&&e.$$eventId===t.$$eventId})):(console.warn("Parameters do not match ."),function(){})}});function _(){return b.default(I._store,"app store does not exist."),I._store.getState()}function M(e,t,r){b.default(h(r[0]),"dispatch parameter must be a objecy");var n=r[0].type;b.default(n&&m(n),"Type is required in the first parameter of the dispatch ,and  type expected to be a string type");var o,c,i,u,a,f=(o=n,c=_(),function(){var t=_();I.subscribe.filter(function(e){return e.$$event===o}).forEach(function(e){return e.apply(null,[c,t])})}),s=n.split("."),l=null;if(2===s.length){var p=s[0],d=s[1],n=I._model.get(p);if(!n)return s=p,void console.log(s);d=function(e,t){var r,n=null;for(r in e)r===t&&(n=e[r]);return n}(n.effect,d);d?(l=d.call.apply(d,[n,(i=e,u=t,a=p,function(e){var t=e.type,t=v(v({},e),{},{type:~t.indexOf(".")?t:"".concat(a,".").concat(t)});return Reflect.apply(i,u,[t])})].concat(y(r))),Promise.resolve().then(function(){f()})):(l=Reflect.apply(e,t,r),f())}else l=Reflect.apply(e,t,r),f();return l}t=q.subscribe;Object.defineProperty(e,"connect",{enumerable:!0,get:function(){return u.connect}}),e.default=q,e.injectModel=w,e.model=function(t){return function(e){return u.connect(function(e){return function t(e,r,n){var o=2<arguments.length&&void 0!==n?n:l();if(Array.isArray(e))e.forEach(function(e){t(e,r,o)});else{var c,n=P(e);if(n)for(c in n.state)o[c]=r[e][c]}return o}(t,e)})(e)}},e.subscribe=t,Object.defineProperty(e,"__esModule",{value:!0})});
